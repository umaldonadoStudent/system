<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HCP Member Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@14.1.0/dist/markdown-it.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Lora:wght@400;600&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        .font-serif { font-family: 'Lora', serif; }
        .sidebar-link { transition: all 0.2s ease-in-out; }
        .sidebar-link:hover, .sidebar-link.active { background-color: #374151; color: white; }
        .content-page { display: none; }
        .content-page.active { display: block; }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .report-container {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border: 1px solid #e2e8f0;
        }
        .report-content h1 {
            font-family: 'Lora', serif;
            font-size: 2.25rem;
            font-weight: 600;
            color: #1e3a8a;
            border-bottom: 2px solid #93c5fd;
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
        }
        .report-content h3 {
            font-family: 'Lora', serif;
            font-size: 1.5rem;
            font-weight: 600;
            color: #1e40af;
            margin-top: 2rem;
            margin-bottom: 1rem;
        }
        .report-content p, .report-content li {
            font-size: 1.1rem;
            line-height: 1.7;
            color: #334155;
        }
        .report-content strong {
            color: #1d4ed8;
        }
        .report-content ul {
            list-style-type: disc;
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }
        .report-content hr {
            border-color: #bfdbfe;
            margin-top: 2rem;
            margin-bottom: 2rem;
        }
    </style>
</head>
<body class="bg-gray-100">

    <!-- LOGIN SCREEN -->
    <div id="login-screen" class="flex items-center justify-center min-h-screen bg-gray-200">
        <div class="w-full max-w-md p-8 space-y-6 bg-white rounded-xl shadow-lg">
            <div class="flex justify-center">
                <div class="flex items-center space-x-2">
                     <svg class="h-10 w-auto" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="40" height="40" rx="8" fill="#2563eb"/><path d="M12 12H16V28H12V12Z" fill="white"/><path d="M28 12H24V28H28V12Z" fill="white"/><path d="M12 19H28V23H12V19Z" fill="white"/></svg>
                    <span class="text-2xl font-bold text-gray-800">Heathrow Capital</span>
                </div>
            </div>
            <h2 class="text-2xl font-bold text-center text-gray-800">Member Portal Login</h2>
            <form id="login-form" class="space-y-6">
                <div>
                    <label for="username" class="text-sm font-medium text-gray-700">Username</label>
                    <input id="username" name="username" type="text" required class="w-full px-4 py-2 mt-2 text-base text-gray-700 bg-gray-100 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label for="password" class="text-sm font-medium text-gray-700">Password</label>
                    <input id="password" name="password" type="password" required class="w-full px-4 py-2 mt-2 text-base text-gray-700 bg-gray-100 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <p id="login-error" class="text-sm text-red-500 text-center hidden">Invalid username or password.</p>
                <div>
                    <button type="submit" id="login-button" class="w-full flex justify-center items-center px-4 py-2 font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors">
                        <span id="login-button-text">Login</span>
                        <div id="login-spinner" class="loader hidden"></div>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- MAIN DASHBOARD -->
    <div id="dashboard" class="hidden">
        <div class="flex h-screen bg-gray-200">
            <!-- Sidebar -->
            <div class="w-64 bg-gray-800 text-white flex flex-col">
                <div class="flex items-center justify-center h-20 border-b border-gray-700">
                     <div class="flex items-center space-x-2">
                        <svg class="h-8 w-auto" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="40" height="40" rx="8" fill="#2563eb"/><path d="M12 12H16V28H12V12Z" fill="white"/><path d="M28 12H24V28H28V12Z" fill="white"/><path d="M12 19H28V23H12V19Z" fill="white"/></svg>
                        <span class="text-xl font-bold">HCP Portal</span>
                    </div>
                </div>
                <nav id="sidebar-nav" class="flex-1 px-4 py-6 space-y-2">
                    <a href="#dashboard-home" class="sidebar-link flex items-center px-4 py-2 rounded-lg active">
                        <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                        Dashboard
                    </a>
                    <a href="#documents" class="sidebar-link flex items-center px-4 py-2 rounded-lg">
                        <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                        Document Kits
                    </a>
                    <a href="#reports" class="sidebar-link flex items-center px-4 py-2 rounded-lg">
                        <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>
                        Reports & Analytics
                    </a>
                    <a href="#webinars" class="sidebar-link flex items-center px-4 py-2 rounded-lg">
                        <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                        Webinars
                    </a>
                    <a href="#subscription" class="sidebar-link flex items-center px-4 py-2 rounded-lg">
                        <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path></svg>
                        Subscription
                    </a>
                </nav>
                <div class="px-4 py-4 border-t border-gray-700">
                    <button id="logout-button" class="w-full sidebar-link flex items-center px-4 py-2 rounded-lg text-left">
                        <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                        Logout
                    </button>
                </div>
            </div>

            <!-- Main Content -->
            <div class="flex-1 flex flex-col overflow-hidden">
                <header class="flex justify-between items-center p-6 bg-white border-b">
                    <h1 id="page-title" class="text-2xl font-semibold text-gray-800">Dashboard</h1>
                    <div id="user-info" class="text-right">
                        <p class="font-semibold text-gray-800">Welcome, <span id="user-name-display"></span></p>
                        <p class="text-sm text-gray-500">Subscription: <span id="user-tier-display"></span></p>
                    </div>
                </header>
                <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-200 p-6">

                    <div id="dashboard-home-page" class="content-page active">
                        <h2 class="text-xl font-semibold text-gray-700 mb-4">Welcome to your Portal</h2>
                        <div class="p-6 bg-white rounded-lg shadow">
                            <p>This is your central hub for all your Heathrow Capital Partners resources. Use the navigation on the left to access your purchased document kits, view market reports, join webinars, and manage your subscription.</p>
                        </div>
                    </div>
                    <div id="documents-page" class="content-page">
                        <h2 class="text-xl font-semibold text-gray-700 mb-4">Your Document Kits</h2>
                        <div id="documents-content" class="p-6 bg-white rounded-lg shadow"></div>
                    </div>

                    <div id="reports-page" class="content-page">
                        <div id="reports-content"></div>
                    </div>

                    <div id="webinars-page" class="content-page">
                        <h2 class="text-xl font-semibold text-gray-700 mb-4">Upcoming Webinars</h2>
                        <div id="webinars-content" class="p-6 bg-white rounded-lg shadow"></div>
                    </div>
                    <div id="subscription-page" class="content-page">
                        <h2 class="text-xl font-semibold text-gray-700 mb-4">Manage Subscription</h2>
                        <div id="subscription-content" class="p-6 bg-white rounded-lg shadow"></div>
                    </div>

                </main>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const loginScreen = document.getElementById('login-screen');
            const dashboard = document.getElementById('dashboard');
            const loginForm = document.getElementById('login-form');
            const loginError = document.getElementById('login-error');
            const logoutButton = document.getElementById('logout-button');
            const sidebarNav = document.getElementById('sidebar-nav');
            const pageTitle = document.getElementById('page-title');
            const loginButtonText = document.getElementById('login-button-text');
            const loginSpinner = document.getElementById('login-spinner');

            let currentUser = null;
            const md = window.markdownit();

            const navigateTo = (hash) => {
                document.querySelectorAll('.content-page').forEach(page => page.classList.remove('active'));
                sidebarNav.querySelectorAll('a').forEach(link => link.classList.remove('active'));
                const targetHash = hash || '#dashboard-home';
                const targetPageId = targetHash.substring(1) + '-page';
                const targetPage = document.getElementById(targetPageId);
                const targetLink = sidebarNav.querySelector(`a[href="${targetHash}"]`);
                if (targetPage && targetLink) {
                    targetPage.classList.add('active');
                    targetLink.classList.add('active');
                    pageTitle.textContent = targetLink.textContent.trim();
                }
            };

            const showDashboard = (user) => {
                currentUser = user;
                sessionStorage.setItem('loggedInUser', JSON.stringify(user));
                loginScreen.style.display = 'none';
                dashboard.style.display = 'block';

                document.getElementById('user-name-display').textContent = user.name;
                document.getElementById('user-tier-display').textContent = user.tier;

                const reportsContentDiv = document.getElementById('reports-content');
                if (user.content && user.content.reports) {
                    const renderedHtml = md.render(user.content.reports);
                    reportsContentDiv.innerHTML = `
                        <div class="report-container p-8 rounded-lg shadow-xl">
                            <div class="report-content">
                                ${renderedHtml}
                            </div>
                        </div>
                    `;
                } else {
                    reportsContentDiv.innerHTML = `
                        <h2 class="text-xl font-semibold text-gray-700 mb-4">Reports & Analytics</h2>
                        <div class="p-6 bg-white rounded-lg shadow">
                            <p class="text-gray-500">No premium reports found in your account.</p>
                        </div>
                    `;
                }

                document.getElementById('documents-content').innerHTML = user.content.documents || '<p class="text-gray-500">No document kits found.</p>';
                document.getElementById('webinars-content').innerHTML = user.content.webinars || '<p class="text-gray-500">No webinars found.</p>';
                document.getElementById('subscription-content').innerHTML = user.content.subscription || '<p class="text-gray-500">No subscription details found.</p>';

                navigateTo(window.location.hash);
            };

            const logout = () => {
                currentUser = null;
                sessionStorage.removeItem('loggedInUser');
                window.location.hash = '';
                loginScreen.style.display = 'flex';
                dashboard.style.display = 'none';
                loginForm.reset();
            };

            const storedUser = sessionStorage.getItem('loggedInUser');
            if (storedUser) {
                try {
                    showDashboard(JSON.parse(storedUser));
                } catch (e) {
                    logout();
                }
            } else {
                loginScreen.style.display = 'flex';
            }

            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                loginError.classList.add('hidden');
                loginButtonText.classList.add('hidden');
                loginSpinner.classList.remove('hidden');

                const username = e.target.username.value;
                const password = e.target.password.value;

                try {
                    const response = await fetch('/api/login', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ username, password })
                    });

                    const data = await response.json();

                    if (response.ok && data.success) {
                        showDashboard(data);
                    } else {
                        loginError.textContent = data.message || "Invalid username or password.";
                        loginError.classList.remove('hidden');
                    }
                } catch (error) {
                    loginError.textContent = "An error occurred. Please try again.";
                    loginError.classList.remove('hidden');
                } finally {
                    loginButtonText.classList.remove('hidden');
                    loginSpinner.classList.add('hidden');
                }
            });

            sidebarNav.addEventListener('click', (e) => {
                const link = e.target.closest('a');
                if (link) {
                    e.preventDefault();
                    window.location.hash = link.getAttribute('href');
                }
            });

            window.addEventListener('hashchange', () => navigateTo(window.location.hash));
            logoutButton.addEventListener('click', logout);
        });
    </script>
</body>
</html>
